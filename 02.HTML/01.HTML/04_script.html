<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>script要素の配置場所ガイド</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            text-align: center;
            padding: 40px 20px;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .content {
            padding: 40px;
        }
        
        .placement-option {
            background: white;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: transform 0.3s ease;
        }
        
        .placement-option:hover {
            transform: translateY(-5px);
        }
        
        .option-header {
            padding: 25px;
            color: white;
            font-size: 1.3em;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .head-placement {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
        }
        
        .body-top-placement {
            background: linear-gradient(45deg, #feca57, #ff9f43);
        }
        
        .body-bottom-placement {
            background: linear-gradient(45deg, #48ca9a, #00d2d3);
        }
        
        .external-placement {
            background: linear-gradient(45deg, #a55eea, #8b78f6);
        }
        
        .option-content {
            padding: 30px;
        }
        
        .pros-cons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .pros {
            background: linear-gradient(145deg, #d4edda, #c3e6cb);
            border-left: 4px solid #28a745;
            padding: 20px;
            border-radius: 8px;
        }
        
        .cons {
            background: linear-gradient(145deg, #f8d7da, #f1b9bc);
            border-left: 4px solid #dc3545;
            padding: 20px;
            border-radius: 8px;
        }
        
        .code-example {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            position: relative;
            white-space: pre-wrap;
        }
        
        .code-example::before {
            content: attr(data-label);
            position: absolute;
            top: -10px;
            left: 15px;
            background: #4a5568;
            color: #e2e8f0;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .timeline-demo {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 25px;
            margin: 25px 0;
        }
        
        .timeline-item {
            display: flex;
            align-items: center;
            margin: 15px 0;
            padding: 15px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .timeline-item:hover {
            transform: translateX(10px);
        }
        
        .parsing {
            background: linear-gradient(145deg, #e3f2fd, #bbdefb);
            border-left: 4px solid #2196f3;
        }
        
        .blocking {
            background: linear-gradient(145deg, #ffebee, #ffcdd2);
            border-left: 4px solid #f44336;
        }
        
        .execution {
            background: linear-gradient(145deg, #e8f5e8, #c8e6c9);
            border-left: 4px solid #4caf50;
        }
        
        .best-practice {
            background: linear-gradient(145deg, #fff3e0, #ffe0b2);
            border: 2px solid #ff9800;
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
        }
        
        .attribute-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .attribute-table th,
        .attribute-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .attribute-table th {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            font-weight: bold;
        }
        
        .attribute-table tr:hover {
            background: #f5f5f5;
        }
        
        .demo-section {
            background: #f0fffe;
            border: 2px solid #4ecdc4;
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
        }
        
        .demo-button {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        .demo-button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .performance-impact {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .impact-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .impact-card:hover {
            transform: translateY(-5px);
        }
        
        .impact-good {
            border-top: 4px solid #28a745;
        }
        
        .impact-warning {
            border-top: 4px solid #ffc107;
        }
        
        .impact-bad {
            border-top: 4px solid #dc3545;
        }
        
        @media (max-width: 768px) {
            .pros-cons {
                grid-template-columns: 1fr;
            }
            
            .content {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>⚡ script要素の配置場所</h1>
            <p>パフォーマンスと実行タイミングを考慮した最適な配置方法</p>
        </div>
        
        <div class="content">
            <div class="best-practice">
                <h3>🎯 結論（現代のベストプラクティス）</h3>
                <p><strong>推奨：</strong> <code>&lt;body&gt;</code>の閉じタグ直前に<code>defer</code>属性付きで配置</p>
                <div class="code-example" data-label="推奨される配置">
&lt;body&gt;
    &lt;!-- HTMLコンテンツ --&gt;
    &lt;h1&gt;ページタイトル&lt;/h1&gt;
    &lt;p&gt;コンテンツ&lt;/p&gt;
    
    &lt;!-- JavaScriptは最後に読み込み --&gt;
    &lt;script defer src="main.js"&gt;&lt;/script&gt;
&lt;/body&gt;
                </div>
            </div>

            <div class="placement-option">
                <div class="option-header head-placement">
                    <span>🏠</span>
                    <span>&lt;head&gt;内に配置</span>
                </div>
                <div class="option-content">
                    <div class="code-example" data-label="head内配置">
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;ページタイトル&lt;/title&gt;
    &lt;script src="script.js"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;!-- HTMLコンテンツ --&gt;
&lt;/body&gt;
                    </div>
                    
                    <div class="pros-cons">
                        <div class="pros">
                            <h4>✅ メリット</h4>
                            <ul>
                                <li>設定やライブラリの早期初期化</li>
                                <li>HTML解析前にコードが利用可能</li>
                                <li>グローバル設定に適している</li>
                            </ul>
                        </div>
                        <div class="cons">
                            <h4>❌ デメリット</h4>
                            <ul>
                                <li>HTML表示がブロックされる</li>
                                <li>DOM要素にアクセスできない</li>
                                <li>ページ表示が遅くなる可能性</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="timeline-demo">
                        <h4>📊 読み込みタイムライン：</h4>
                        <div class="timeline-item parsing">
                            <strong>1.</strong> HTML解析開始
                        </div>
                        <div class="timeline-item blocking">
                            <strong>2.</strong> script要素に遭遇 → HTML解析停止
                        </div>
                        <div class="timeline-item execution">
                            <strong>3.</strong> JavaScriptダウンロード・実行
                        </div>
                        <div class="timeline-item parsing">
                            <strong>4.</strong> HTML解析再開 → ページ表示
                        </div>
                    </div>
                </div>
            </div>

            <div class="placement-option">
                <div class="option-header body-top-placement">
                    <span>🔝</span>
                    <span>&lt;body&gt;の開始直後</span>
                </div>
                <div class="option-content">
                    <div class="code-example" data-label="body開始直後">
&lt;body&gt;
    &lt;script src="analytics.js"&gt;&lt;/script&gt;
    
    &lt;!-- HTMLコンテンツ --&gt;
    &lt;h1&gt;ページタイトル&lt;/h1&gt;
&lt;/body&gt;
                    </div>
                    
                    <div class="pros-cons">
                        <div class="pros">
                            <h4>✅ メリット</h4>
                            <ul>
                                <li>アナリティクス等の早期実行</li>
                                <li>ユーザー行動の完全な追跡</li>
                                <li>初期化処理に適している</li>
                            </ul>
                        </div>
                        <div class="cons">
                            <h4>❌ デメリット</h4>
                            <ul>
                                <li>コンテンツ表示の遅延</li>
                                <li>DOM要素はまだ存在しない</li>
                                <li>ユーザビリティに影響</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="placement-option">
                <div class="option-header body-bottom-placement">
                    <span>⬇️</span>
                    <span>&lt;/body&gt;の直前（推奨）</span>
                </div>
                <div class="option-content">
                    <div class="code-example" data-label="body終了直前（推奨）">
&lt;body&gt;
    &lt;!-- HTMLコンテンツ --&gt;
    &lt;h1&gt;ページタイトル&lt;/h1&gt;
    &lt;p&gt;コンテンツ&lt;/p&gt;
    
    &lt;!-- ページ最後にスクリプト読み込み --&gt;
    &lt;script src="main.js"&gt;&lt;/script&gt;
&lt;/body&gt;
                    </div>
                    
                    <div class="pros-cons">
                        <div class="pros">
                            <h4>✅ メリット</h4>
                            <ul>
                                <li>HTML表示がブロックされない</li>
                                <li>全てのDOM要素にアクセス可能</li>
                                <li>優れたユーザー体験</li>
                                <li>従来の標準的な配置方法</li>
                            </ul>
                        </div>
                        <div class="cons">
                            <h4>⚠️ 注意点</h4>
                            <ul>
                                <li>大きなスクリプトは読み込みが遅い</li>
                                <li>DOMContentLoaded待ちが必要</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="timeline-demo">
                        <h4>📊 読み込みタイムライン：</h4>
                        <div class="timeline-item parsing">
                            <strong>1.</strong> HTML解析 → ページ表示
                        </div>
                        <div class="timeline-item execution">
                            <strong>2.</strong> JavaScriptダウンロード・実行
                        </div>
                        <div class="timeline-item execution">
                            <strong>3.</strong> インタラクティブ機能が有効化
                        </div>
                    </div>
                </div>
            </div>

            <div class="placement-option">
                <div class="option-header external-placement">
                    <span>🚀</span>
                    <span>属性を使った最適化</span>
                </div>
                <div class="option-content">
                    <h4>defer属性（推奨）：</h4>
                    <div class="code-example" data-label="defer属性（現代の推奨方法）">
&lt;head&gt;
    &lt;script defer src="main.js"&gt;&lt;/script&gt;
    &lt;script defer src="utils.js"&gt;&lt;/script&gt;
&lt;/head&gt;
                    </div>
                    
                    <h4>async属性：</h4>
                    <div class="code-example" data-label="async属性">
&lt;head&gt;
    &lt;script async src="analytics.js"&gt;&lt;/script&gt;
    &lt;script async src="ads.js"&gt;&lt;/script&gt;
&lt;/head&gt;
                    </div>
                    
                    <table class="attribute-table">
                        <tr>
                            <th>属性</th>
                            <th>読み込み</th>
                            <th>実行</th>
                            <th>用途</th>
                        </tr>
                        <tr>
                            <td><strong>なし</strong></td>
                            <td>HTML解析をブロック</td>
                            <td>即座に実行</td>
                            <td>重要な初期化コード</td>
                        </tr>
                        <tr>
                            <td><strong>defer</strong></td>
                            <td>並行してダウンロード</td>
                            <td>HTML解析完了後</td>
                            <td>DOM操作を行うスクリプト</td>
                        </tr>
                        <tr>
                            <td><strong>async</strong></td>
                            <td>並行してダウンロード</td>
                            <td>ダウンロード完了次第</td>
                            <td>独立したスクリプト</td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="demo-section">
                <h3>🧪 実行タイミングの可視化デモ</h3>
                <p>ボタンをクリックして、異なる配置方法での実行タイミングを確認：</p>
                
                <button class="demo-button" onclick="showTimingDemo('normal')">通常のscript</button>
                <button class="demo-button" onclick="showTimingDemo('defer')">defer属性</button>
                <button class="demo-button" onclick="showTimingDemo('async')">async属性</button>
                <button class="demo-button" onclick="showTimingDemo('bottom')">body末尾</button>
                
                <div id="timing-demo" class="timeline-demo">
                    ボタンをクリックしてデモを開始
                </div>
            </div>

            <div class="performance-impact">
                <div class="impact-card impact-good">
                    <h4>🚀 最高パフォーマンス</h4>
                    <p><strong>defer属性 + head内</strong></p>
                    <ul>
                        <li>並行ダウンロード</li>
                        <li>HTML表示をブロックしない</li>
                        <li>適切な実行順序</li>
                    </ul>
                </div>
                
                <div class="impact-card impact-good">
                    <h4>✅ 良好なパフォーマンス</h4>
                    <p><strong>body末尾配置</strong></p>
                    <ul>
                        <li>HTML表示優先</li>
                        <li>DOM操作可能</li>
                        <li>安全な実行環境</li>
                    </ul>
                </div>
                
                <div class="impact-card impact-warning">
                    <h4>⚠️ 条件付きで使用</h4>
                    <p><strong>async属性</strong></p>
                    <ul>
                        <li>独立したスクリプト向け</li>
                        <li>実行順序は不定</li>
                        <li>依存関係に注意</li>
                    </ul>
                </div>
                
                <div class="impact-card impact-bad">
                    <h4>❌ パフォーマンス問題</h4>
                    <p><strong>head内（属性なし）</strong></p>
                    <ul>
                        <li>HTML解析をブロック</li>
                        <li>表示の遅延</li>
                        <li>ユーザー体験の悪化</li>
                    </ul>
                </div>
            </div>

            <div class="best-practice">
                <h3>💡 実践的な配置戦略</h3>
                
                <h4>🎯 用途別の推奨配置：</h4>
                <div class="code-example" data-label="完璧なscript配置例">
&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;最適化されたページ&lt;/title&gt;
    
    &lt;!-- 重要なライブラリ（早期読み込み、順序重要） --&gt;
    &lt;script defer src="vendor/jquery.js"&gt;&lt;/script&gt;
    &lt;script defer src="vendor/bootstrap.js"&gt;&lt;/script&gt;
    
    &lt;!-- メインのアプリケーションコード --&gt;
    &lt;script defer src="js/main.js"&gt;&lt;/script&gt;
    
    &lt;!-- 独立したサービス（順序不問） --&gt;
    &lt;script async src="analytics.js"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;!-- コンテンツ --&gt;
    &lt;h1&gt;ページタイトル&lt;/h1&gt;
    
    &lt;!-- 条件付きで読み込むスクリプト --&gt;
    &lt;script&gt;
    if (userNeedsAdvancedFeatures) {
        import('./advanced-features.js')
            .then(module =&gt; module.initialize());
    }
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
                </div>
                
                <h4>📋 チェックリスト：</h4>
                <ul>
                    <li>✅ DOM操作スクリプトは<code>defer</code>属性を使用</li>
                    <li>✅ 独立したスクリプト（Analytics等）は<code>async</code>属性</li>
                    <li>✅ 重要でないスクリプトは動的読み込みを検討</li>
                    <li>✅ スクリプトの依存関係を明確にする</li>
                    <li>✅ パフォーマンス測定ツールで確認</li>
                </ul>
            </div>

            <div class="timeline-demo">
                <h3>⏱️ モダンなスクリプト読み込み手法</h3>
                
                <h4>1. ES Modules（推奨）：</h4>
                <div class="code-example" data-label="ES Modules">
&lt;script type="module" src="main.js"&gt;&lt;/script&gt;

// main.js
import { initializeApp } from './app.js';
import { setupEventListeners } from './events.js';

document.addEventListener('DOMContentLoaded', () =&gt; {
    initializeApp();
    setupEventListeners();
});
                </div>
                
                <h4>2. 動的インポート：</h4>
                <div class="code-example" data-label="動的インポート">
// 条件付きで機能を読み込み
async function loadFeature() {
    if (shouldLoadFeature) {
        const { feature } = await import('./feature.js');
        feature.initialize();
    }
}

// ユーザーアクションに応じて読み込み
button.addEventListener('click', async () =&gt; {
    const { handleClick } = await import('./click-handler.js');
    handleClick();
});
                </div>
                
                <h4>3. Service Worker活用：</h4>
                <div class="code-example" data-label="Service Worker">
// メインスレッドをブロックしない重要でない処理
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js')
        .then(() =&gt; {
            // バックグラウンドで重い処理を実行
        });
}
                </div>
            </div>
        </div>
    </div>

    <script>
        function showTimingDemo(type) {
            const demo = document.getElementById('timing-demo');
            
            const demos = {
                normal: `<h4>🔴 通常のscript要素（head内）:</h4>
<div class="timeline-item parsing">⏳ HTML解析開始</div>
<div class="timeline-item blocking">🛑 script要素に遭遇 → 解析停止</div>
<div class="timeline-item execution">📥 JavaScriptダウンロード</div>
<div class="timeline-item execution">⚡ JavaScript実行</div>
<div class="timeline-item parsing">🔄 HTML解析再開</div>
<div class="timeline-item execution">🎨 ページ表示</div>
<p><strong>問題：</strong> JavaScript処理中はページ表示がブロックされる</p>`,

                defer: `<h4>🟢 defer属性付きscript:</h4>
<div class="timeline-item parsing">⏳ HTML解析開始</div>
<div class="timeline-item execution">📥 JavaScript並行ダウンロード開始</div>
<div class="timeline-item parsing">🎨 ページ表示（解析継続）</div>
<div class="timeline-item execution">✅ HTML解析完了</div>
<div class="timeline-item execution">⚡ JavaScript実行</div>
<p><strong>メリット：</strong> ページ表示を妨げず、DOM操作も安全</p>`,

                async: `<h4>🟡 async属性付きscript:</h4>
<div class="timeline-item parsing">⏳ HTML解析開始</div>
<div class="timeline-item execution">📥 JavaScript並行ダウンロード開始</div>
<div class="timeline-item blocking">⚡ ダウンロード完了次第すぐ実行</div>
<div class="timeline-item parsing">🔄 HTML解析再開</div>
<div class="timeline-item execution">🎨 ページ表示</div>
<p><strong>注意：</strong> 実行タイミングが不定、DOM未完成の可能性</p>`,

                bottom: `<h4>🔵 body末尾配置:</h4>
<div class="timeline-item parsing">⏳ HTML解析</div>
<div class="timeline-item execution">🎨 ページ表示</div>
<div class="timeline-item execution">📥 JavaScript開始</div>
<div class="timeline-item execution">⚡ JavaScript実行</div>
<div class="timeline-item execution">🚀 インタラクティブ機能有効化</div>
<p><strong>特徴：</strong> 確実にDOM完成後実行、順次読み込み</p>`
            };
            
            demo.innerHTML = demos[type] || 'デモが見つかりません';
        }
        
        // 初期デモ表示
        showTimingDemo('defer');
    </script>
</body>
</html>